#!/usr/bin/execlineb -P
# -*- mode: sh -*-
# vi: set ft=sh:
with-contenv
multisubstitute
{
  import -i DRUPAL_ROOT
}
ifelse { s6-test -e /assets/drupal-files.tgz } {
  foreground {
    empty_directory ${DRUPAL_ROOT}/sites/default/files
  }
  importas -u ? ?
  ifelse { s6-test ! -d ${DRUPAL_ROOT}/sites/default/files -o $? -eq 0  } {
    foreground {
      tar -xzf /assets/drupal-files.tgz -C ${DRUPAL_ROOT}/sites/default
    } chown -R www-data:www-data $DRUPAL_ROOT
  } echo "Drupal files have already been deployed."
} echo "No Drupal files to deploy."
